---
title: 'Solutions des exercices: probabilités et statistique'
author: "Jacques van Helden"
date: '`r Sys.Date()`'
output:
  pdf_document:
    fig_caption: yes
    highlight: zenburn
    toc: no
    toc_depth: 3
  slidy_presentation:
    fig_caption: yes
    fig_height: 6
    fig_width: 7
    highlight: tango
    incremental: no
    keep_md: no
    smaller: yes
    theme: cerulean
    toc: yes
    toc_float: yes
    widescreen: yes
  ioslides_presentation:
    colortheme: dolphin
    fig_caption: yes
    fig_height: 6
    fig_width: 7
    fonttheme: structurebold
    highlight: tango
    incremental: no
    keep_md: no
    smaller: yes
    theme: cerulean
    toc: yes
    widescreen: yes
  html_document:
    code_folding: hide
    fig_caption: yes
    highlight: zenburn
    theme: cerulean
    toc: yes
    toc_depth: 3
    toc_float: yes
  beamer_presentation:
    colortheme: dolphin
    fig_caption: yes
    fig_height: 6
    fig_width: 7
    fonttheme: structurebold
    highlight: tango
    incremental: no
    keep_tex: no
    slide_level: 2
    theme: Montpellier
    toc: yes
  word_document:
    toc: yes
    toc_depth: 3
font-import: http://fonts.googleapis.com/css ?family=Risque
font-family: Garamond
subtitle: Probabilités et statistique pour la biologie (STAT1)
address: TAGC lab, Aix-Marseille Université, France
transition: linear
---

```{r include=FALSE, echo=FALSE, eval=TRUE}
library(knitr)
library(diagram) ## For flowcharts


options(width=300)
knitr::opts_chunk$set(
  fig.width = 7, fig.height = 5, 
  fig.align = "center", 
  fig.path = "figures/sampling-estimation_",
  size = "tiny", 
  echo = FALSE, eval=TRUE, 
  warning = FALSE, message = FALSE, 
  results = TRUE, comment = "")
# knitr::asis_output("\\footnotesize")

dir.main <- "~/stat1"
dir.slides <- file.path(dir.main, "slides")
setwd(dir.slides)
```


## Probabilité des longueurs d'ORF

On détecte les cadres ouverts de lecture (*open reading frames*, *ORF*) d'un génome en identifiant toutes les séquences de taille multiple de 3 comprises entre un start (ATG) et un stop (TAA, TAG ou TGA). 

a. Sur base des fréquences génomiques de trinucléotides, calculer la probabilité de trouver à une position donnée du génome un ORF d'au moins 100 codons (plus précisément, la probabilité qu'à cette position précise commence un cadre ouvert de lecture d'au moins 100 codons). 
b. Sachant que le génome fait 12 Mb, quel est le nombre attendu d'ORF d'au moins 100 codons ?


```{r echo=FALSE}
oligo.freq <- read.table("../data/Saccharomyces_cerevisiae/oligo_freq/3nt_genomic_Saccharomyces_cerevisiae-ovlp-1str.tab", sep="\t", row.names = NULL)
colnames(oligo.freq) <- c("sequence", "frequency", "occurrences")
oligo.freq$frequency <- round(digits=3, oligo.freq$frequency)

row.names(oligo.freq) <- oligo.freq$sequence

#oligo.freq["...",] <- c("...", "...", "...")

selected.oligos <- c("AAA", "ATG", "TAA", "TAG", "TGA")

kable(data.frame(oligo.freq[selected.oligos, ]), row.names = FALSE)
#print(data.frame(oligo.freq[selected.oligos, ]))
```

### Solution: probabilité des longueurs d'ORF


On sélectionne aléatoirement une position du génome ($i$). Nous allons raisonner en terme de codons (triplets de nucléotides): pour chaque position $i$ on observe le triplet couvrant les nucléotides de $i$ à $i+1$, et on avance par pas de 3 ($i, i+3, +6, \ldots$).

Pour y trouver le début d'un cadre ouvert de lecture d'au moins 100 codons,il faut remplir les conditions suivantes.

```{r proba_start}
P.start <- oligo.freq["ATG", "frequency"]
```

1. Présence d'un codon start (trinucléotide ATG) à la position $i$. La probabilité associée est directement fournie dans le tableau: $P(\text{ATG}) = `r round(digits=3, P.start)`$.

2. Absence de codon stop (trinucléotides TAA, TAG ou TGA) pour les 99 triplets suivants (positions). 



### Probabilité d'absence du codon stop à une position donnée

L'absence d'un codon stop est l'événement *complémentaire* de la présence d'un condon stop (on observe exclusivement l'un ou l'autre). On en déduit que la somme des probabilités (absence ou présence) vaut 1. 

$P(\lnot \text{STOP}) = 1 - P(\text{STOP})$

Le symbole $\lnot$ représente la négation logique (logical NOT). 

Calculons la probabilité de **présence d'un codon stop** à une position donnée. Pour cela, il faut observer à cette position l'un des trois triplets suivants: TAG, TGA, TAA. Ces événements sont *mutuellement exclusifs*: à une position donnée, on en peut pas observer *à la fois* un TAA et un TGA.  La probabilité d'observer l'un d'entre eux (probabilité de leur union) est donc la somme des probabilités individuelles. 

```{r proba_stop, results=FALSE}
P.stop <- sum(oligo.freq[c("TAA", "TAG", "TGA"), "frequency"])
```


$$
\begin{aligned}
P(\text{STOP}) &= P(\text{TAA}) + P(\text{TAG}) + P(\text{TGA}) \\ 
    &= `r round(digits=3, oligo.freq["TAA", "frequency"])` + `r round(digits=3, oligo.freq["TAG", "frequency"])` + `r round(digits=3, oligo.freq["TGA", "frequency"])` = `r round(digits=3, P.stop)`
\end{aligned}
$$

On en détuit la probabilité d'**absence d'un codon stop** à une position donnée.


```{r proba_not_stop, results=FALSE}
P.not.stop <- 1 - P.stop
```


$$P(\lnot\text{STOP}) = 1 = P(\text{STOP} = 1 - `r round(digits=2, P.stop)` = `r round(digits=2, P.not.stop)` $$
### Probabilité d'absence du codon stop à une position donnée


Nous pouvons maintenant calculer la probabilité d'avoir un cadre ouvert de lecture d'au moins 100 codons qui commence à une position arbitraire $i$ du génome. 

Ceci correspond à la *probabilité jointe* (le ET logique) de l'ensemble des conditions requises. 

- présence d'un codon start à la position $i$,
- ET absence de codon stop en position $i+3$,
- ET absence de codon stop en position $i+6$,
- ET $\ldots$
- ET absence de codon stop en position $i+197$.

On peut considérer que ces événements sont *indépendants* (le codon observé en position $i+3$ ne dépend pas de celui observé en position $i$). Leur probabilité jointe est donc le produit des probabilités individuelles. 

```{r proba_ORF_100codons}
P.orf.100 <- P.start * P.not.stop^99
```


$$
\begin{aligned}
P(\text{ORF}_{100}) &= P(\text{START}) \cdot  \overbrace{P(\lnot \text{STOP})  \cdot \ldots \cdot P(\lnot \text{STOP}) }^{\text{99 times}} \\
&= P(\text{START}) \cdot P(\lnot \text{STOP})^{99} \\
&= `r P.start` \cdot `r P.not.stop`^{99} = `r signif(digits=4, P.orf.100)`
\end{aligned}
$$

A priori cette probabilité n'a pas l'air énorme. Cependant, il faut tenir compte du fait qu'en annotant un génome on considère successivement toutes les positions possibles pour évaluer si on y trouve un cadre ouvert de lecture. 

### Nombre attendu d'ORF d'au moins 100 codons

Pour calculer le nombre d'ORF attendus au hasard, il faut multiplier la probabilité d'observer un ORF à une position donnée par le nombre de positions considérées. 

```{r genome_expected_ORFs}
G <- 12e6
exp.ORFs <- P.orf.100 * 2 * G
```

Pour un génome de 12 Mb ($G = `r G`$), on va considérer toutes les positions sur chacun des deux brins (on multiple donc par deux la taille du génome). 

$$E(\text{ORF}_{100}) = P(\text{ORF}_{100}) \cdot 2 \cdot G = `r signif(digits=4, P.orf.100)` \cdot 2 \cdot `r G` = `r round(digits=1, exp.ORFs)`$$

### Interprétation du résultat

En 1996, lors de la première vague d'annotation du génome de la levure du boulanger, la stratégie d'annotation consistait à predire un gène codant chaque fois qu'on détectait un cadre ouvert de lecture d'au moins 100 codons. Les chercheurs étaient conscients du fait que cette stratégie était susceptible de produire un nombre important de fausses prédictions, mais il s'agissait du tout premier génome eucaryote séquencé, et il fallait bien commencr par quelque chose pour se donner une chance d'y découvrir de nouveaux gènes. 

Nous venons de calculer le nombre attendu de faux-positifs dans ce processus: si on avait généré une séquence aléatoire de la même taille selon un modèle de Markov respectant les mêmes fréquences de trinucléotides, on s'attendrait à y trouver `r round(digits=1, exp.ORFs)` cadres ouverts de lecture d'au moins 100 codons. Ceci indique que les gènes de taille relativement courte (300 nucléotides) devaient être considérés avec circonspection, et soumis à analyse ultérieure avant d'être annotés comme des gènes fiables. 

En 2003, une stratégie complémentaire a été mise à contribution pour évaluer la fiabilité des ORF prédits dans le génome de *Saccharomyces cerevisiae*, en s'appuyant sur la génomique comparative: après avoir séquençé les génomes de quelques autres espèces du même genre (*Saccharomyces*), on a testé la conservation des ORF initialement prédits, en supposant que si on trouvait des ORF similaires dans les 4 espèces, cela suggérait une pression sélective positive pour l'absence de codon stop dans ces régions, et renforçait la prédiction d'un gène codant correspondant à ce cadre ouvert de lecture. 

## Probabilité d'un motif avec erreurs

On recherche dans un génome les occurrences du motif GATAAG  en admettant un certain nombre de substitutions. En supposant que les nucléotides sont indépendants et équiprobables, quelle est la probabilité de trouver à une position du génome: 

a. Une instance exacte du motif (aucune substitution) ?
b. Une séquence ne présentant aucune correspondance avec le motif (6 substitutions) ?
c. Une instance avec exactement 1 substitution ?
d. Une instance avec au plus 2 substitutions ?

## Alignement de lectures NGS sans erreur

Au terme d'un séquençage de type "Next Generation Sequencing" (NGS), on dispose d'une librairie de $N=10^6$ lectures courtes. On aligne la librairie sur le génome de référence, dont la somme des chromosomes fait $G=10^9$ paires de bases, en utilisant un algorithme d'alignement sans gap.

Calculez la distribution de probabilité du nombre de correspondances en fonction de la longueur des lectures ($k$). 


## Alignement de lecture NGS avec erreurs

Un biologiste a fait séquencer un échantillon et a obtenu un fichier comportant 50 millions de lectures (« short reads ») de 35 paires de base, qu’il aligne sur le génome humain (3 gigabases répartis sur 23 chromosomes). Durant l’alignement, il choisit d’accepter au maximum 3 substitutions par lecture.  

a. En supposant un modèle de fond basé sur des nucléotides équiprobables et distribués de façon indépendante, comment calculeriez-vous la probabilité pour qu’un read s’aligne complètement à une position arbitraire du génome, avec au plus 3 substitutions (sans indel). Indiquez la formule et justifiez votre choix.

b. Sous ces mêmes conditions, quel serait le nombre de faux-positifs attendus si l’on aligne l’ensemble de la librairie de séquences sur l’ensemble du génome ?


## Sites de restriction

Dans un génome bactérien de 4 Mb avec une composition de 50% de G+C, on observe 130 occurrences de l'hexanucléotide GGCGCC. On suppose un schéma de Bernoulli et une composition équiprobable de nucléotides.

(a) Quelle est la probabilité d’observer une occurrence de GGCGCC à une position donnée du génome ?
(b) Combien d'occurrences s'attend-on à trouver dans l'ensemble du génome ?
(c) Quelle serait la probabilité d'observer un nombre aussi faible d'occurrences (130 ou moins) si l'on générait une séquence aléatoire selon le modèle de Bernoulli avec nucléotides équiprobables ?
(d) Comment peut-on interpréter cette sous-représentation de l'hexanucléotide GGCGCC du point de vue biologique ?


## Détection de différence d'expression

Un chercheur a analysé, à l’aide de biopuces, le niveau d’expression de l’ensemble des gènes à partir d’échantillons sanguins prélevés chez 50 patients (np=50) et chez 50 sujets témoins (nt=50). Il s’intéresse particulièrement à un gène qui semble montrer une différence entre les 2 groupes. Ainsi, il ré-analyse l’expression du même gène dans les mêmes échantillons en utilisant une autre technique, la qPCR. Il obtient 

-	pour les patients, une moyenne $m_p= 21$
-	pour les contrôles, une moyenne $m_t= 10$
-	des écarts-types identiques pour les 2 groupes $s_p= s_t= s = 15$

Afin de tester si la différence observée entre les moyennes est significative, le chercheur décide d’effectuer un test de Student.

a.	Le choix du test de Student vous semble-t-il approprié ? Justifiez le choix du chercheur. Quelles auraient été les alternatives envisageables ?

b.	Sachant qu’a priori on ne sait pas dans quel sens la maladie pourrait affecter le niveau d’expression du gène, préconisez-vous un test uni- ou bilatéral ?

c.	Formulez l’hypothèse nulle et expliquez-la en une phrase.

d.	Sur base de la formule ci-dessous, calculez la statistique $t$ de Student.

e.	Indiquez, en vous basant sur les tables fournies, la p-valeur correspondante. 

f.	Interprétez la p-valeur, et aidez le chercheur à tirer les conclusions de son étude.


## Taux d'anticorps

Un groupe de chercheurs a détecté l’association, avec la résistance à la bilharziose, de taux élevés d’IgE spécifiques, une classe particulière d’anticorps. D’autres chercheurs ont cherché à répliquer ce résultat dans une population indépendante exposée à la bilharziose. Les résultats obtenus sont indiqués ci-dessous.

-	Pour les sujets résistants ($n_r=32$), la moyenne $m_r=10$.
-	Pour les sujets susceptibles ($n_s=32$), la moyenne $m_s=7$.
-	Les écarts-types des deux groupes sont égaux : $s_r = s_s = s = 2.8$.

a. Quelle méthode préconisez-vous pour tester l'égalité des moyennes (justifiez) ? Quelles sont les hypothèses de travail de ce test ?

b. En partant du principe que ces conditions sont remplies dans le cas présent, formulez l’hypothèse nulle et calculez le score t de Student (formule ci-dessous). Enfin, estimez P valeur à partir de la table fournie. 

c. A l'issue du test, quelle décision prenez-vous ? Justifiez votre réponse.

## Enrichissement fonctionnel

Dans le génome de la levure, 40 gènes ont été assignés à la classe fonctionnelle "Biological Process: Methionin Biosynthesis". Une expérience de transcriptome rapporte 80 gènes différentiellement exprimés, dont 10 appartiennent à cette classe fonctionnelle. Sachant que le génome comporte 6000 gènes, peut-on consiérer ce résultat comme significatif ?


## Jeu de roulette

La roulette comporte 37 nombres allant du 0 au 36. Un joueur a décidé de miser systématiquement 1 euro sur le nombre 17 jusqu’à ce que ce nombre sorte, et de s’arrêter ensuite. Sachant que quand on mise sur un seul nombre, le gain vaut 36 fois la mise, quelle est la probabilité pour que le joueur sorte du casino en ayant gagné de l’argent ? Il n’est pas nécessaire de fournir une réponse numérique, vous pouvez vous contenter d’indiquer la formule, en indiquant les nombres correspondant aux différents symboles mathématiques. Justifiez votre réponse en expliquant votre raisonnement. 


## Concepts de probabilité

En quoi consiste le modèle de Bernoulli ? Ce modèle est-il généralement adapté à l'analyse des séquences biologiques ? Justifiez en quelques phrases.


<!--
## Exercices: occurrences d'hexanucleotides

On a compté les occurrences de chaque hexanucleotide sur une séquence génomique de 6 kilobases, sur un simple brin. On dénombre 7 occurrences de la séquence GATACA.

a.	Quel est le nombre total d'hexanucléotides possibles ?
b.	En supposant que les nucléotides sont répartis de façon indépendante et équiprobable au sein de la séquence, quelle serait la probabilité de trouver le mot GATACA à une position donnée de cette séquence (vous pouvez utiliser une approximation pour faciliter le calcul) ?
c.	Sur base du même modèle (nucléotides indépendants et équiprobables), quel serait le nombre attendu d'occurrences de GATACA dans cette séquence ?

On décide maintenant d'adopter un modèle légèrement plus adapté, en tenant compte de la composition nucléotidique de la séquence (Table 1).

d.	Sur base de la composition nucléotidique, quelle serait la probabilité de trouver le mot GATACA à une position donnée de la séquence ? Expliquez le mode de calcul et fournissez une formule de calcul, ainsi qu'une approximation de la valeur numérique du résultat.
e.	Selon ce modèle, quel serait le nombre attendu d'occurrences dans une séquence aléatoire de la même taille et de la même composition nucléotidique ?

Les Tables 2 et 3 fournissent les probabilités d'occurrences (densités et p-valeurs) d'une loi de Poisson, avec différentes valeurs d'espérance (lambda, λ).

a.	Indiquez la p-valeur des occurrences de GATACA dans la séquence considérée, pour le modèle qui prend en compte la composition nucléotidique (utilisez la distribution la plus proche de celle du modèle).
b.	Quel serait le nombre attendu de faux-positifs (la e-valeur) si l'on appliquait ce même seuil de p-valeur à chaque hexanucléotide ?
c.	Interprétez la p-valeur (calculée en a) et la e-valeur (calculée en b). Peut-on considérer que le mot GATACA est significativement surreprésenté ?

-->



