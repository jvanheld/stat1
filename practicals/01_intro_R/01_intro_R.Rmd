---
title: "Premiers pas avec R"
author: "Jacques van Helden"
date: '`r Sys.Date()`'
output:
  slidy_presentation:
    fig_caption: yes
    fig_height: 6
    fig_width: 7
    highlight: tango
    incremental: no
    keep_md: no
    smaller: yes
    theme: cerulean
    toc: yes
    toc_float: yes
    widescreen: yes
  html_document:
    fig_caption: yes
    highlight: zenburn
    theme: cerulean
    toc: yes
    toc_depth: 3
    toc_float: yes
  ioslides_presentation:
    colortheme: dolphin
    fig_caption: yes
    fig_height: 6
    fig_width: 7
    fonttheme: structurebold
    highlight: tango
    incremental: no
    keep_md: no
    smaller: yes
    theme: cerulean
    toc: yes
    widescreen: yes
  pdf_document:
    fig_caption: yes
    highlight: zenburn
    toc: yes
    toc_depth: 3
  beamer_presentation:
    colortheme: dolphin
    fig_caption: yes
    fig_height: 6
    fig_width: 7
    fonttheme: structurebold
    highlight: tango
    incremental: no
    keep_tex: no
    slide_level: 2
    theme: Montpellier
    toc: yes
  word_document:
    toc: yes
    toc_depth: 3
font-import: http://fonts.googleapis.com/css ?family=Risque
font-family: Garamond
subtitle: Probabilités et statistique pour la biologie (STAT1)
address: TAGC lab, Aix-Marseille Université, France
transition: linear
---

```{r setup, include=FALSE, size="huge"}
library(knitr)
## Default parameters for displaying the slides
knitr::opts_chunk$set(
  echo = TRUE, 
  eval=TRUE, 
  fig.width = 7, 
  fig.height = 5, 
  fig.align = "center", 
  fig.path = "figures/",
  size = "tiny", 
  warning = FALSE, 
  results = TRUE, 
  message = FALSE, 
  comment = "")

dir.main <- "~/stat1"
dir.current <- file.path(dir.main, "practicals", "01_intro_R")
setwd(dir.current)

```


## But de ce tutoriel

Le but de ce tutoriel est de décuvrir les éléments fondamentaux du langage de statistiques ***R***. 

Nous aborderons les éléments suivants: 

- Manupulation de variables

    - Assignation d'une valeur à une variable
    - Opérations basiques sur des nombres
    - Structures de base: Ecteurs, matrices et data.frames

- Graphiques

- Distributions de probabilités


## Utiliser ***R*** comme calculette

**Exemple:** une addition avec R.

```{r}
2 + 5
```

Le résultat affiché ($7$) est précédé d'un indice ($[1]$). Nous verrons ultérieurement l'utilisation de ces indices. 

## Assignation d'une valeur à une variable

En ***R***, **`<-`** signifie "crée une variable et assigne-lui une valeur".


**Exemple:** 

- créer une variable nommée $a$, 
- lui assigner la valeur $2$, 
- imprimer le résultat avec la fonction ***print()***. 

```{r}
a <- 2
print(a)
```

## Calculer avec des variables

**Exemple:** 

- créer une variable nommée $b$ avec une valeur $5$, 
- calculer  $a + b$ et enregistrer le résultat dans une variable nommée $c$,
- imprimer le résultat. 

```{r}
b <- 5
c <- a + b
print(a)
print(b)
print(c)
```

## Assignation $\neq$ égalité

**Exemple:** 

- remplacer la valeur de $a$ par $3$, 
- imprimer la valeur de $c$
- est-il toujours vrai que $c = a + b$ ? Pourquoi ?

```{r}
a <- 3 ## Change the value of a
print(a)
print(b)
print(c)

## Check whether c equals a + b
c == a + b
```

Note: **`==`** indique qu'on teste si deux variables ont le même contenu. Le résultat est une valeur logique (TRUE ou FALSE).

## Recalculer un résultat

Quand on change le contenu d'une variable $a$, une autre variable ($c$) préalablement calculées à partir de cette variable n'a aucune raison d'être recalculée si on ne le demande pas explicitement. 

**Exemple:** 

- remplacer la valeur de $a$ par $27$, 
- recalculer et imprimer la valeur de $c$
- tester l'égalité $c = a + b$

```{r}
a <- 27 ## Change the value of a
c <- a + b
print(c) ## Print the value of c

## Check whether c  equals a + b
c == a + b
```

## Vecteurs de valeurs

En  ***R***, la structure de données la plus simple est un **vecteur**. 

- Dans l'exemple précédent, la variable $a$ ne contenait qu'un seul nombre, mais en pratique elle était stockée dans un vecteur à une seule entrée. 
- La fonction `print()` indique les indices en début de lignes, ce qui est utile quand on affiche des vecteurs avec un grand nombre d'entrées. 


**Exemple:** créer une variable nommée  ***trois.nombres***, et l'initialiser avec un vecteur dont les valeurs sont ***27***, ***12*** and ***3000***.

**Trucs:**
- en R, les noms de variables peuvent comporter plusieurs mots séparés par des points; 
- la fonction `c()` combine plusieurs valeurs en un vecteur.

```{r}
trois.nombres <- c(27,12,3000)
print(trois.nombres)
```


## Séries de nombres

La façon la plus simple de créer une série de nombre est d'utiliser le double point, qui génère toutes les valeurs entières entre deux limites. 

```{r}
x <- 0:30
print(x)
```

## Calculer avec des vecteurs


**R** permet de manipuler les vecteurs de façon extrêmement pratique. 
Une opération sur un vecteur s'applique automatiquement à tous ses éléments. 


```{r}
x <- 1:10 # Define a series from 1 to 10
print(x)
y <- x^2 # Compute the square of each number
print(y)
```


## Séquences de nombres

La fonction `seq()` permet de générer des séries de nombres avec un espacement arbitraire. 

```{r}
seq(from=-1, to=1, by=0.1)
```

## Les variables peuvent contenir du texte

Les variables ne se limitent pas aux nombres: elles peuvent contenir du texte ("chaînes de caractères", "strings" en anglais).

```{r}
# The # symbol allows to insert comments in R code

# Define  a vector named "whoami", and 
# containing two names
whoami <- c("Denis", "Siméon")
print(whoami) # Comment at the end of a line
```

## Concaténation de chaînes de caractèrs

La fonction `paste()` permet de concaténer les variables contenant du texte. 

```{r}
# Define  a vector named "names", and 
# containing two names
prenom <- "Denis Siméon"
nom <- "Poisson"

# Paste the values of a vector of string 
print(paste(sep=" ", prenom, nom))
```


## Fonctions graphiques

R comporte un grand nombre de fonctions permettant de dessiner des graphiques simples ou élaborés. Nous allons explorer ici les méthodes les plus simples. 

## Nuage de points (scatter plot)

```{r scatter_plot, fig.width=7, fig.height=5, fig.align="center"}
x <- -10:10
y <- x^2
plot(x,y)
```

## Courbe (line plot)


```{r line_plot, fig.width=7, fig.height=5, fig.align="center"}
x <- -10:10
y <- x^2
plot(x,y, type="l")
```

## Distributions de probabilités

**R** fournit 4 fonctions pour chacune des des distributions de probabilité classiques. 

Avant d'aller plus loin, lisez attentivement l'aide pour les fonctions associées à la distribution binomiale.

```{r binomial_help}
help("Binomial")

```

**Questions:** 

1. Quelle est la fonction R qui permet de calculer la fonction de masse de probabilité ?
2. Quelle fonction R correspond à la fonction de répartition ?
2. A quoi sert la fonction *rbinom()* ?

## Graphe de la binomiale

**Exercice:** en supposant des nucléotides équiprobables et indépendants, dessiner la probazbilité du nombre d'adénines pour un oligonucléotide de taille 30. 


## Formule de la solution

Le nombre d'adénines peut prendre n'importe quelle valeur entre $0$ et $30$. On peut modéliser le problème comme un schéma de Bernoulli avec $n=30$ essais pouvant chacun résulter en un succès (une adénine) avec une probabilité $p=0.25$, ou un échec (tout autre nucléotide), avec une probabilité $q = 1-p = 0.75$. 

La probabilité d'observer exactement $x$ adénine vaut donc. 

$$P(X=x) = \binom{n}{x} p^x (1-p)^{n-x} = \frac{30!}{x!(30-x)!} \cdot 0.25^x \cdot 0.75^{n-x}$$
où $x$ peut prendre n'importe quelle valeur entre $0$ et $30$. 

## Calcul de la fonction de masse de probabilité

```{r binomial_PMF}
## Define all possible values for X
n <- 30
x <- 0:n
p <- 0.25

## Compute the binomial PMF
pmf <- dbinom(x = x, size = n, prob = p)
```

## Sous-ensemble des valeurs d'un vecteur

Nous pouvons imprimer les 4 premières valeurs de la variable *pmf* (pour $x$ de $0$ à $3$) ...

```{r}
pmf[1:5]
```

... ou les 4 dernières valeurs (pour $x$ de $27$ à $30$).

```{r}
pmf[(n-3):n]
```

## Restriction du nombre de décimales

La fonction `round()` arrondit un résultat à un nombre donné de décimales. 

```{r}
round(pmf, digit=3)
```

Pour des distributions de probabilités, on descend assez facilement à des valeurs très faibles, dont on désire connaître l'ordre de grandeur tout en affichant un nombre raisonnable de chiffres significatifs (ceux qui suivent la première décimale non nulle). Pour cela, il est plus pratique d'utiliser la fonction `signif()`, 

```{r}
signif(pmf, digit=3)
```


## Plotting the Poisson distribution


```{r dpois_plot, fig.width=7, fig.height=4, fig.align="center"}
x <- 0:14   # Define the X values from 0 to 14
y <- dpois(x, lambda = 2.5) # Poisson density
plot(x,y) # Check the result
```

This first plot is not very nice. Let us get some help to improve it.

## Getting help for ***R*** functions


Need help ? Type **`help()`**. 

```{r}
help(plot)
```

A question ? Type ` ?`

```{r}
 ?plot
```

**Result:** ***R*** displays the help message for the function `dpois()`.

## Exercise: improve Poisson density plot


1. Do not (yet) look the next slide.
2. Read the help page for the `dpois()`function.
3. draw a plot that provides a didactic illustration of the  Poisson density.

## Improve the plot: type = histogram


```{r dpois_plot_h, fig.width=7, fig.height=4, fig.align="center"}
x <- 0:14
lambda <- 2.54
y <- dpois(x, lambda)
plot(x,y, type="h")
```

## Improve the plot: Add a title


```{r dpois_plot_h_main, fig.width=7, fig.height=4, fig.align="center"}
plot(x,y, type="h", lwd=5, col="blue",
     main="Poisson density")
```

## Improve the plot: define axis labels


```{r dpois_plot_h_xylab, fig.width=7, fig.height=4, fig.align="center"}
plot(x,y, type="h", lwd=5, col="blue",
     main="Poisson density",
     xlab="x = number of successes",
     ylab="P(X=x)")
```

## Improve the plot: add a legend


```{r dpois_plot_h_legend, fig.width=7, fig.height=4, fig.align="center"}
plot(x,y, type="h", lwd=5, col="blue",
     main="Poisson density",
     xlab="x = number of successes",
     ylab="P(X=x)")
legend("topright", paste("lambda =", lambda))
```


## Poisson: a family of curves


**Exercice:** explore the properties of the Poisson density function, by changing the rang of $x$ values, and the $\lambda$ parameter.



## Solution: a family of Poisson curves

$lambda=0.01$

```{r dpois_series_lambda0_01, fig.width=7, fig.height=4, fig.align="center"}
lambda <- 0.01
x <- 0:20
plot(x, dpois(x,lambda=lambda), type="h",   
     col="darkblue", lwd=5, xlab="X",ylab="dpois(x)")
legend("topright", paste("lambda=",lambda))
```

## Solution: a family of Poisson curves

$lambda=0.1$

```{r dpois_series_lambda0_1, fig.width=7, fig.height=4, fig.align="center"}
lambda <- 0.1
x <- 0:20
plot(x, dpois(x,lambda=lambda), type="h",   
     col="darkblue", lwd=5, xlab="X",ylab="dpois(x)")
legend("topright", paste("lambda=",lambda))
```

## Solution: a family of Poisson curves

$lambda=1$

```{r dpois_series_lambda1, fig.width=7, fig.height=4, fig.align="center"}
lambda <- 1
x <- 0:20
plot(x, dpois(x,lambda=lambda), type="h",   
     col="darkblue", lwd=5, xlab="X",ylab="dpois(x)")
legend("topright", paste("lambda=",lambda))
```

## Solution: a family of Poisson curves

$lambda=2$

```{r dpois_series_lambda2, fig.width=7, fig.height=4, fig.align="center"}
lambda <- 2
x <- 0:20
plot(x, dpois(x,lambda=lambda), type="h",   
     col="darkblue", lwd=5, xlab="X",ylab="dpois(x)")
legend("topright", paste("lambda=",lambda))
```

## Solution: a family of Poisson curves

$lambda=5$

```{r dpois_series_lambda5, fig.width=7, fig.height=4, fig.align="center"}
lambda <- 5
x <- 0:20
plot(x, dpois(x,lambda=lambda), type="h",   
     col="darkblue", lwd=5, xlab="X",ylab="dpois(x)")
legend("topright", paste("lambda=",lambda))
```

## Solution: a family of Poisson curves

$lambda=5$

```{r dpois_series_lambda5_range40, fig.width=7, fig.height=4, fig.align="center"}
lambda <- 5
x <- 0:40
plot(x, dpois(x,lambda=lambda), type="h",   
     col="darkblue", lwd=5, xlab="X",ylab="dpois(x)")
legend("topright", paste("lambda=",lambda))
```

## Solution: a family of Poisson curves

$lambda=10$

```{r dpois_series_lambda10, fig.width=7, fig.height=4, fig.align="center"}
lambda <- 10
x <- 0:(4*lambda)
plot(x, dpois(x,lambda=lambda), type="h",   
     col="darkblue", lwd=5, xlab="X",ylab="dpois(x)")
legend("topright", paste("lambda=",lambda))
```

## Solution: a family of Poisson curves

$lambda=20$

```{r dpois_series_lambda20, fig.width=7, fig.height=4, fig.align="center"}
lambda <- 20
x <- 0:(4*lambda)
plot(x, dpois(x,lambda=lambda), type="h",   
     col="darkblue", lwd=2, xlab="X",ylab="dpois(x)")
legend("topright", paste("lambda=",lambda))
```

## Solution: a family of Poisson curves

$lambda=30$

```{r dpois_series_lambda30, fig.width=7, fig.height=4, fig.align="center"}
lambda <- 30
x <- 0:(2*lambda)
plot(x, dpois(x,lambda=lambda), type="h",   
     col="darkblue", lwd=2, xlab="X",ylab="dpois(x)")
legend("topright", paste("lambda=",lambda))
```

## Solution: a family of Poisson curves

$lambda=50$

```{r dpois_series_lambda50, fig.width=7, fig.height=4, fig.align="center"}
lambda <- 50
x <- 0:(2*lambda)
plot(x, dpois(x,lambda=lambda), type="h",   
     col="darkblue", lwd=2, xlab="X",ylab="dpois(x)")
legend("topright", paste("lambda=",lambda))
```

## Solution: a family of Poisson curves

$lambda=100$

```{r dpois_series_lambda100, fig.width=7, fig.height=4, fig.align="center"}
lambda <- 100
x <- 0:(2*lambda)
plot(x, dpois(x,lambda=lambda), type="h",   
     col="darkblue", lwd=2, xlab="X",ylab="dpois(x)")
legend("topright", paste("lambda=",lambda))
```

## Solution: a family of Poisson curves

$lambda=1000$

```{r dpois_series_lambda1000, fig.width=7, fig.height=4, fig.align="center"}
lambda <- 1000
x <- 0:(2*lambda)
plot(x, dpois(x,lambda=lambda), type="h",   
     col="darkblue", lwd=2, xlab="X",ylab="dpois(x)")
legend("topright", paste("lambda=",lambda))
```

## Solution: a family of Poisson curves

$lambda=10000$

```{r dpois_series_lambda10000, fig.width=7, fig.height=4, fig.align="center"}
lambda <- 10000
x <- 0:(2*lambda)
plot(x, dpois(x,lambda=lambda), type="h",   
     col="darkblue", lwd=2, xlab="X",ylab="dpois(x)")
legend("topright", paste("lambda=",lambda))
```

## Solution: a family of Poisson curves

$lambda=100000$

```{r dpois_series_lambda10000_rescaled, fig.width=7, fig.height=4, fig.align="center"}
plot(95000:105000, dpois(95000:105000,lambda=100000), type="h", col="darkblue", xlab="X",ylab="dpois(x)")
```

## Avant de terminer : conservez la trace de votre session

La traçabilité constitue un enjeu essentiel en sciences. 
La fonction ***R***  `sessionInfo()` fournit un résumé des conditions d'une session de travail: version de R, système opérateur, bibliothèques de fonctions utilisées. 


```{r}
sessionInfo()
```

